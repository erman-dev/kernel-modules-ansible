---
# This role loads one kernel module specified in "insert_kernel_module_data"

- name: "Fail on incorrect input"
  ansible.builtin.fail:
    msg: >-
      To run this role, you need to pass insert_kernel_module_data object with attribute
      "name" defined.
  when: insert_kernel_module_data.name is not defined

- name: "Import CPU info tasks"
  ansible.builtin.import_tasks: cpu_info.yml

- name: "Import insert module tasks"
  ansible.builtin.include_tasks: insert_module.yml
  when: |
    insert_kernel_module_data |
    check_cpu_constraints(insert_kernel_module_cpu_family, insert_kernel_module_cpu_model) |
    bool
